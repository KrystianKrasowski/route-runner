<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="551px" preserveAspectRatio="none" style="width:780px;height:551px;" version="1.1" viewBox="0 0 780 551" width="780px" zoomAndPan="magnify"><defs><filter height="300%" id="f13001ugsp0toq" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f13001ugsp0toq)" height="133.6641" style="stroke: #000000; stroke-width: 2.0;" width="382.5" x="387" y="71.5938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="60" x2="60" y1="54.5938" y2="494.4531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="204" x2="204" y1="54.5938" y2="494.4531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="342" x2="342" y1="54.5938" y2="494.4531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="448" x2="448" y1="54.5938" y2="494.4531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="593.5" x2="593.5" y1="54.5938" y2="494.4531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="714.5" x2="714.5" y1="54.5938" y2="494.4531"/><rect fill="#98FB98" filter="url(#f13001ugsp0toq)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="8" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="33" x="41.5" y="22.9951">«isr»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="15" y="39.292">TIM2 update</text><rect fill="#98FB98" filter="url(#f13001ugsp0toq)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="8" y="493.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="33" x="41.5" y="513.4482">«isr»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="15" y="529.7451">TIM2 update</text><rect fill="#98FB98" filter="url(#f13001ugsp0toq)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="161" x="122" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="33" x="186" y="22.9951">«isr»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="129" y="39.292">SPI transfer complete</text><rect fill="#98FB98" filter="url(#f13001ugsp0toq)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="161" x="122" y="493.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="33" x="186" y="513.4482">«isr»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="129" y="529.7451">SPI transfer complete</text><rect fill="#98FB98" filter="url(#f13001ugsp0toq)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="297" y="19.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="304" y="39.292">Data store</text><rect fill="#98FB98" filter="url(#f13001ugsp0toq)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="297" y="493.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="304" y="513.4482">Data store</text><rect fill="#98FB98" filter="url(#f13001ugsp0toq)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="98" x="397" y="19.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="404" y="39.292">Notifications</text><rect fill="#98FB98" filter="url(#f13001ugsp0toq)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="98" x="397" y="493.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="404" y="513.4482">Notifications</text><rect fill="#98FB98" filter="url(#f13001ugsp0toq)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="101" x="541.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="64" x="560" y="22.9951">«device»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="87" x="548.5" y="39.292">DualShock 2</text><rect fill="#98FB98" filter="url(#f13001ugsp0toq)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="101" x="541.5" y="493.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="64" x="560" y="513.4482">«device»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="87" x="548.5" y="529.7451">DualShock 2</text><rect fill="#87CEFA" filter="url(#f13001ugsp0toq)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="85" x="670.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="71" x="677.5" y="22.9951">«adapter»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="688" y="39.292">Control</text><rect fill="#87CEFA" filter="url(#f13001ugsp0toq)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="85" x="670.5" y="493.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="71" x="677.5" y="513.4482">«adapter»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="688" y="529.7451">Control</text><path d="M387,71.5938 L451,71.5938 L451,78.5938 L441,88.5938 L387,88.5938 L387,71.5938 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="133.6641" style="stroke: #000000; stroke-width: 2.0;" width="382.5" x="387" y="71.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="402" y="84.6606">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="184" x="466" y="83.8042">[before first or already read]</text><polygon fill="#A80036" points="605,105.8594,595,109.8594,605,113.8594,601,109.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="714" y1="109.8594" y2="109.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29" x="611" y="104.7935">read</text><polygon fill="#A80036" points="459,134.9922,449,138.9922,459,142.9922,455,138.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="453" x2="593" y1="138.9922" y2="138.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="465" y="133.9263">take DUALSHOCK2</text><polygon fill="#A80036" points="582,164.125,592,168.125,582,172.125,586,168.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="448" x2="588" y1="168.125" y2="168.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="30" x="455" y="163.0591">false</text><polygon fill="#A80036" points="703,193.2578,713,197.2578,703,201.2578,707,197.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="594" x2="709" y1="197.2578" y2="197.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="601" y="192.1919">not ready</text><polygon fill="#A80036" points="582,234.3906,592,238.3906,582,242.3906,586,238.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="60" x2="588" y1="238.3906" y2="238.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="67" y="233.3247">poll start</text><path d="M599,217.2578 L599,242.2578 L695,242.2578 L695,227.2578 L685,217.2578 L599,217.2578 " fill="#FBFB77" filter="url(#f13001ugsp0toq)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M685,217.2578 L685,227.2578 L695,227.2578 L685,217.2578 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="75" x="605" y="234.3247">every 16ms</text><polygon fill="#A80036" points="582,268.5234,592,272.5234,582,276.5234,586,272.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="204.5" x2="588" y1="272.5234" y2="272.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="211.5" y="267.4575">poll stop</text><polygon fill="#A80036" points="330,297.6563,340,301.6563,330,305.6563,334,301.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="204.5" x2="336" y1="301.6563" y2="301.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="211.5" y="296.5903">store response</text><polygon fill="#A80036" points="436,326.7891,446,330.7891,436,334.7891,440,330.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="204.5" x2="442" y1="330.7891" y2="330.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="211.5" y="325.7231">give DUALSHOCK2</text><polygon fill="#A80036" points="605,355.9219,595,359.9219,605,363.9219,601,359.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="599" x2="714" y1="359.9219" y2="359.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29" x="611" y="354.856">read</text><polygon fill="#A80036" points="459,385.0547,449,389.0547,459,393.0547,455,389.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="453" x2="593" y1="389.0547" y2="389.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="465" y="383.9888">take DUALSHOCK2</text><polygon fill="#A80036" points="582,414.1875,592,418.1875,582,422.1875,586,418.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="448" x2="588" y1="418.1875" y2="418.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="26" x="455" y="413.1216">true</text><polygon fill="#A80036" points="353,443.3203,343,447.3203,353,451.3203,349,447.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="593" y1="447.3203" y2="447.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="359" y="442.2544">read and validate</text><polygon fill="#A80036" points="703,472.4531,713,476.4531,703,480.4531,707,476.4531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="594" x2="709" y1="476.4531" y2="476.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="601" y="471.3872">controller state</text><!--MD5=[9c75c4e36c7ea76c4243b44eab846dc9]
@startuml impl-hardware-commands-ready

participant "TIM2 update" as tim_isr <<isr>> #palegreen
participant "SPI transfer complete" as dma_isr <<isr>> #palegreen
participant "Data store" as data #palegreen
participant "Notifications" as notifications #palegreen
participant "DualShock 2" as dualshock2 <<device>> #palegreen
participant "Control" as adapter <<adapter>> #lightskyblue

alt before first or already read
    dualshock2 <- adapter : read
    dualshock2 -> notifications : take DUALSHOCK2
    dualshock2 <- - notifications : false
    dualshock2 - -> adapter : not ready
end

tim_isr -> dualshock2 : poll start
note right : every 16ms
dma_isr -> dualshock2 : poll stop
dma_isr -> data : store response
dma_isr -> notifications : give DUALSHOCK2
dualshock2 <- adapter : read
dualshock2 -> notifications : take DUALSHOCK2
dualshock2 <- - notifications : true
dualshock2 -> data : read and validate
dualshock2 - -> adapter : controller state

@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.7+6-Debian-1
Operating System: Linux
Default Encoding: UTF-8
Language: pl
Country: PL
--></g></svg>